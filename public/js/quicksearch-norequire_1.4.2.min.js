// Marketplace Quicksearch 1.4.2
var culture,baseUri,countXhr,currentArgs,$=jQuery,settings={url:"https:leer.test"},models=!1,modelgroups=!1,series=!1,variants=!1,manufacturersWithSeries=[],manufacturersWithModelGroups=[],fixedManufacturers=[],fixedManufacturersModelGroupTypes=[],manufacturers=[],bodies=[],bodiesPKW=[],bodiesMOT=["motorcycle"],bodiesNFZ=["fahrgestell","pritschenfahrzeug","transporter"],target="/",seriesList=[],sortManAlphabetic=!1,others=["other","otherMOT","otherNFZ"],manufacturerMappings={cupra:"CUPRA",mercedes:"Mercedes-Benz",seat:"SEAT",skoda:"ŠKODA",vw:"Volkswagen"},uiConfig={};function toCamelCase(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/\s+/g,"-").toLowerCase()}function renameManufacturer(e){var r=toCamelCase(e);return settings.renameManufacturers&&manufacturerMappings[r]?manufacturerMappings[r]:e}function initButtons(){console.log("Quicksearch marketplace 4.0 template 1.4.2");var t=$(".quick-search-button"),l=$(".quick-search-body");t.click(function(){var e=t.index(this),r=l.filter(":visible").index();!0===l.is(":visible")&&e+1!=r?(l.hide(),l.eq(e).fadeIn()):l.eq(e).slideToggle()})}function loadConfig(){$.getJSON(baseUri+"/uiconfig/all",{culture:culture,apikey:apikey},function(e){(uiConfig=e).searchForm&&e.searchForm.manufacturersWithSeries&&(manufacturersWithSeries=e.searchForm.manufacturersWithSeries),fixedManufacturers=e.searchForm.fixedManufacturers||[],fixedManufacturersModelGroupTypes=e.searchForm.fixedManufacturersModelGroupTypes||[],console.info("manufacturersWithSeries ",manufacturersWithSeries),console.info("fixedManufacturers ",fixedManufacturers),console.info("fixedManufacturersModelGroupTypes ",fixedManufacturersModelGroupTypes),$.getJSON(baseUri+"/criteria/all",{culture:culture,apikey:apikey},function(e){for(var r in manufacturers=e.manufacturers)manufacturers[r].originalLabel=manufacturers[r].label,manufacturers[r].label=renameManufacturer(manufacturers[r].label);bodies=e.bodies,bodiesPKW=bodies.filter(function(e){return-1===bodiesMOT.indexOf(e.value)&&-1===bodiesNFZ.indexOf(e.value)});var t=[];if(settings.exactAllLabels?$("#fahrzeugtyp").append('<option value="" selected>Alle Fahrzeugtypen</option>'):$("#fahrzeugtyp").append('<option value="" selected>Alle</option>'),e.bodyGroups){for(var r in t=e.bodyGroups.filter(function(e){return!(!1===e.isActive)}))$("#fahrzeugtyp").append('<option value="'+t[r].value+'">'+t[r].label+"</option>");makeSelect($("#fahrzeugtyp"))}initSelectors(),initPriceSelector(),initMilageSelector(),initRegisterSelector()})})}function getManufacturerById(r){var e=manufacturers.filter(function(e){if(e.value==r)return!0})[0];return e||{label:""}}function isFixed(e){for(var r=0;r<fixedManufacturers.length;r++)if(fixedManufacturers[r]==e)return!0;return!1}function isFixedPKW(e){for(var r=0;r<fixedManufacturers.length;r++)if(fixedManufacturers[r]==e&&"PKW"===fixedManufacturersModelGroupTypes[r])return!0;return!1}function initSelectors(){$("#fahrzeugart").find("option").remove(),settings.exactAllLabels?$("#fahrzeugart").append('<option value="" selected>Alle Fahrzeugarten</option>'):$("#fahrzeugart").append('<option value="" selected>Alle</option>'),$.getJSON(baseUri+"/criteria/usagetypes",{culture:culture,apikey:apikey},function(e){for(var r in e)$("#fahrzeugart").append('<option value="'+e[r].value+'">'+e[r].label+"</option>");makeSelect($("#fahrzeugart"))}),$.getJSON(baseUri+"/criteria/bodies",{culture:culture,apikey:apikey},function(e){for(var r in e=e.filter(function(e){return e.isActive||!0}),settings.exactAllLabels?$("#karosserie").append('<option value="" selected>Alle Karosserien</option>'):$("#karosserie").append('<option value="" selected>Alle</option>'),e)$("#karosserie").append('<option value="'+e[r].value+'">'+e[r].label+"</option>");makeSelect($("#karosserie"))}),$("#hersteller").find("option").remove(),settings.exactAllLabels?$("#hersteller").append('<option value="" selected>Alle Hersteller</option>'):$("#hersteller").append('<option value="" selected>Alle</option>');for(var e=[],r=0;r<fixedManufacturers.length;r++){var t="",l="";l="PKW"===fixedManufacturersModelGroupTypes[r]?(t=fixedManufacturers[r]+"_"+fixedManufacturersModelGroupTypes[r],getManufacturerById(fixedManufacturers[r]).label+""):"MOT"===fixedManufacturersModelGroupTypes[r]?(t=fixedManufacturers[r]+"_"+fixedManufacturersModelGroupTypes[r],getManufacturerById(fixedManufacturers[r]).label+" Motorrad"):"NFZ"===fixedManufacturersModelGroupTypes[r]?(t=fixedManufacturers[r]+"_"+fixedManufacturersModelGroupTypes[r],getManufacturerById(fixedManufacturers[r]).label+" Nutzfahrzeuge"):(t=fixedManufacturers[r]+"_ALL",getManufacturerById(fixedManufacturers[r]).label),originalLabel=getManufacturerById(fixedManufacturers[r]).originalLabel,e.push({value:t,label:l,originalLabel:originalLabel||""})}sortManAlphabetic&&(e=e.sort(sortAlphabetic));for(r=0;r<e.length;r++)$("#hersteller").append('<option value="'+e[r].value+'">'+e[r].label+"</option>");sortManAlphabetic&&!marketplace.hideOtherManufactueres&&0<e.length&&$("#hersteller").append("<option disabled >-----------------------------------------------</option>"),marketplace.hideOtherManufactueres||$.getJSON(baseUri+"/criteria/manufacturers",{culture:culture,apikey:apikey},function(e){for(var r in e=e.filter(function(e){return e.isActive&&!isFixed(e.value)}),sortManAlphabetic&&(e=e.sort(sortAlphabetic)),e)e[r].originalLabel=e[r].label,e[r].label=renameManufacturer(e[r].label),$("#hersteller").append('<option value="'+e[r].value+'">'+e[r].label+"</option>");makeSelect($("#hersteller"))}),$("#kraftstoff").find("option").remove(),settings.exactAllLabels?$("#kraftstoff").append('<option value="" selected>Alle Kraftstoffe</option>'):$("#kraftstoff").append('<option value="" selected>Alle</option>'),$.getJSON(baseUri+"/criteria/fuellings",{culture:culture,apikey:apikey},function(e){for(var r in e)$("#kraftstoff").append('<option value="'+e[r].value+'">'+e[r].label+"</option>");makeSelect($("#kraftstoff"))})}window.amQuicksearchVersion="1.4.2";var manufacturerId=0,manufacturerType="";function sortAlphabetic(e,r){var t=e.originalLabel||e.label,l=r.originalLabel||r.label;return l<t?1:t<l?-1:0}function initModelSelector(){$("#hersteller").val()&&(manufacturerId=parseInt($("#hersteller").val().split("_")[0]),manufacturerType=$("#hersteller").val().split("_")[1]||"ALL");var o=$("#modell").val();console.log("initModelSelector();",manufacturerId,manufacturerType),variants=series=modelgroups=models=!1,$("#modell").find("option").remove(),settings.exactAllLabels?$("#modell").append('<option value="" selected>Alle Modelle</option>'):$("#modell").append('<option value="" selected>Alle</option>'),0<manufacturerId&&(-1<manufacturersWithSeries.indexOf(manufacturerId)&&"MOT"!==manufacturerType&&"NFZ"!==manufacturerType?(console.log("manufacturersWithSeries"),$.getJSON(baseUri+"/criteria/series",{manufacturers:$("#hersteller").val().split("_")[0],culture:culture,apikey:apikey},function(e){if(0<(e=e.filter(function(e){return e.isActive||!0})).length){for(var r in series=!0,seriesList=[],e)$("#modell").append('<option value="'+e[r].value+'">'+e[r].label+"</option>"),seriesList.push(e[r].label);queryCount()}else variants=!0,$.getJSON(baseUri+"/criteria/variants",{manufacturers:$("#hersteller").val().split("_")[0],culture:culture,apikey:apikey},function(e){for(var r in e=e.filter(function(e){return e.isActive||!0}))$("#modell").append('<option value="'+e[r].value+'">'+e[r].label+"</option>")});makeSelect($("#modell"))})):$.getJSON(baseUri+"/criteria/models",{manufacturers:$("#hersteller").val().split("_")[0],culture:culture,apikey:apikey},function(n){modelgroups=!1,console.log(makeSelect,n),n=n.filter(function(e){return e.isActive}),$.getJSON(baseUri+"/criteria/modelgroups",{manufacturers:$("#hersteller").val().split("_")[0],culture:culture,apikey:apikey},function(e){if(0<e.length){console.log("manufacturersWithModelgroups"),series=!(modelgroups=!0),$("#modell").find("option").remove(),settings.exactAllLabels?$("#modell").append('<option value="" selected>Alle Modelle</option>'):$("#modell").append('<option value="" selected>Alle</option>');var l=null;for(var r in modelgroupsList=[],modelgroupsListValues=[],e){e[r=parseInt(r,10)].grouptype;if(!e[r].groupType||"ALL"===manufacturerType||e[r].groupType===manufacturerType){var t=e[r].items;if("hide"===settings.modelsWithoutFinds||settings.modelsWithCounter)t.forEach(function(e){modelgroupsList.push(e),modelgroupsListValues.push(e.value)});else for(var a in t)-1<others.indexOf(t[a].value)?(l=t[a],t.splice(a,1)):$("#modell").append('<option value="'+t[a].value+'">'+t[a].label+"</option>");o&&(console.log($('#modell option[value="'+o+'"]').length),setTimeout(function(){console.log($("#modell option").length),console.log($('#modell option[value="'+o+'"]').length),$('#modell option[value="'+o+'"]').attr("selected","selected")},100))}}console.log(modelgroupsList);var s={},i=settings.preselection;s.manufacturers=$("#hersteller").val().split("_")[0],s.culture=culture,s.apikey=apikey,s.modelgroups=modelgroupsListValues,s.template=getTemplateString(i),$.getJSON(baseUri+"/vehicles/count/bymodelgroups",getCountQuery(s),function(e){for(var r in console.log(e),modelgroupsList)if(-1<others.indexOf(modelgroupsList[r].value)&&0===e[r])l=modelgroupsList[r];else{var t='<option value="'+modelgroupsList[r].value+'" ';0===e[r]&&(t+=' class="no-vehicles" '),o===modelgroupsList[r].value&&(t+=" selected "),t+=">"+modelgroupsList[r].label,settings.modelsWithCounter&&(0<modelgroupsList[r]?t+=" ("+modelgroupsList[r]+") ":t+=" (0) "),t+="</option>",$("#modell").append(t)}l&&("show"===settings.modelsWithoutFinds||l.isActive)&&$("#modell").append('<option value="'+l.value+'">'+l.label+"</option>")})}else{for(var a in models=!(modelgroups=!1),n)$("#modell").append('<option value="'+n[a].value+'">'+n[a].label+"</option>");makeSelect($("#modell"))}})}))}function initPriceSelector(){$("#preismin").find("option").remove(),$("#preismin").append('<option value="" selected>min.</option>'),$("#preismax").find("option").remove(),$("#preismax").append('<option value="" selected>max.</option>');for(var e=uiConfig.valueRanges.prices.maxs,r=0;r<e.length;r++)$("<option/>").val(e[r]).html(e[r].toLocaleString(culture)+" €").appendTo("#preismin"),$("<option/>").val(e[r]).html(e[r].toLocaleString(culture)+" €").appendTo("#preismax")}function initMilageSelector(){$("#zulassungvon").find("option").remove(),$("#kilometerbis").append('<option value="" selected>von</option>');for(var e=uiConfig.valueRanges.mileages.maxs,r=0;r<e.length;r++)$("<option/>").val(e[r]).html(e[r].toLocaleString(culture)+" km").appendTo("#kilometerbis")}function initRegisterSelector(){$("#zulassungvon").find("option").remove(),$("#zulassungvon").append('<option value="" selected>von</option>');for(var e=(new Date).getFullYear(),r=0;r<10;r++)$("<option/>").val(e).html(e).appendTo("#zulassungvon"),e--}function makeSelect(e){console.log("makeSelect",e)}function refreshPriceMin(e){console.log("refreshPriceMin",e),e.value=parseInt(e.value)}function refreshPriceMax(e){console.log("refreshPriceMax",e),e.value=parseInt(e.value)}function getBodies(){var e=($("#hersteller").val()||"ALL").split("_")[1];return"MOT"===e?bodiesMOT:"NFZ"===e?bodiesNFZ:"PKW"===e?bodiesPKW:""}function queryCount(){console.log("queryCount()"),countXhr&&countXhr.abort();$("#fahrzeugart").val(),$("#karosserie").val(),$("#fahrzeugtyp").val();var e={zip:"",distance:"",usageTypes:[],manufacturers:[],manufacturersType:$("#hersteller").val()?$("#hersteller").val().split("_")[1]:[],models:"",bodies:"",bodyGroups:"",fuellings:"",transmission:"",powerKwMin:"",powerKwMax:"",paints:[],metallic:!1,priceMin:"",priceMax:"",registermin:null,registermax:null,vatdeductible:!1};settings.preselection&&settings.preselection.fuellings&&(e.fuellings=settings.preselection.fuellings);var r={zip:$("#plz").val(),distance:$("#umkreis").val(),usageTypes:0<$("#fahrzeugart").prop("selectedIndex")?$("#fahrzeugart").val():null,bodyGroups:0<$("#fahrzeugtyp").prop("selectedIndex")?[$("#fahrzeugtyp").val()]:null,bodies:0<$("#karosserie").prop("selectedIndex")?$("#karosserie").val():null,manufacturers:$("#hersteller").val()?$("#hersteller").val().split("_")[0]:[],manufacturersType:$("#hersteller").val()?$("#hersteller").val().split("_")[1]:[],models:0<$("#modell").prop("selectedIndex")?[$("#modell").val()]:null,fuellings:e.fuellings||$("#kraftstoff").val(),transmission:$("#getriebe").val(),powerKwMin:$("#slider-leistung-quicksearch-value-lower").val(),powerKwMax:$("#slider-leistung-quicksearch-value-upper").val(),paints:$("#farbe").val(),metallic:!!$("#metallic").prop("checked")||null,priceMin:0<$("#preismin").val()?$("#preismin").val():null,priceMax:0<$("#preismax").val()?$("#preismax").val():null,registerMin:0<$("#zulassungvon").val()?$("#zulassungvon").val():null,registerMax:0<$("#zulassungbis").val()?$("#zulassungbis").val():null,mileageMax:0<$("#kilometerbis").val()?$("#kilometerbis").val():null,vatdeductible:!!$("#mwstausweisbar").prop("checked")||null},t=($("#hersteller").val()||"0").split("_")[0];manufacturerId=parseInt(t)||0,r.othermanufacturers=null,0<manufacturerId&&!isFixed(manufacturerId)&&(r.othermanufacturers=!0),(currentArgs=r).models=null,r.series=null,r.variants=null,manufacturers&&(modelgroups?r.modelGroups=0<$("#modell").prop("selectedIndex")?[$("#modell").val()]:null:series?(r.series=0<$("#modell").prop("selectedIndex")?[$("#modell").val()]:null,r.series&&"object"==typeof r.series&&(r.series=r.series.join(","),r.series=r.series.replace(/"/g,""),r.series=r.series.replace(/"/g,""))):variants?r.variants=0<$("#modell").prop("selectedIndex")?[$("#modell").val()]:null:r.models=0<$("#modell").prop("selectedIndex")?[$("#modell").val()]:null),$("#carsearchlink").attr("href",settings.url+settings.hash+target+getListPageQuery(r)),settings.newWindow&&$("#carsearchlink").attr("target","_blank"),settings.debug&&$("#output").html(settings.url+settings.hash+target+getListPageQuery(r)),countXhr=$.getJSON(baseUri+"/vehicles/count/?"+getCountQuery(r),function(e){$(".quicksearch-count").text(e)}),settings.modelsWithoutFinds}function getListPageQuery(e){var r=[];for(var t in e)if(e[t]&&!$.isFunction(e[t])){var l=e[t];if("manufacturersType"===t)0<l.length&&r.push(t+"="+l);else if("series"===t)r.push(t+"="+l);else if($.isNumeric(l))r.push(t+"="+parseFloat(l));else if("boolean"==typeof l)r.push(t+"="+l);else if("string"==typeof l)r.push(t+'="'+l+'"');else if(!$.isArray(l)||0<l.length){var a=JSON.stringify(l).substring(1);a=a.substring(0,a.length-1),r.push(t+"="+a)}}for(var s in r)r[s]||delete r[s];return 0===r.length?"":"?"+r.join("&")}function getCountQuery(e){var r=0,t="";$("#hersteller").val()&&(r=parseInt($("#hersteller").val().split("_")[0]),t=$("#hersteller").val().split("_")[1]||"ALL"),manufacturers.forEach(function(e){e.value==r&&e.label});var l=[];for(var a in e)e[a]&&!$.isFunction(e[a])&&("manufacturersType"==a&&"ALL"!==t&&toQuery(l,"bodyGroups",t.toLowerCase()),toQuery(l,modelgroups&&"modelGroups"==a?"models":modelgroups&&"models"==a?"models":series&&"series"==a?"series":a,e[a]));for(var s in l)l[s]||delete l[s];return toQuery(l,"apikey",apikey),l.join("&")}function toQuery(e,r,t){if($.isArray(t))for(var l in t)toQuery(e,r,t[l]);else $.isNumeric(t)?e.push(r+"="+parseFloat(t)):"string"==typeof t?e.push(r+"="+t):e.push(r+"="+JSON.stringify(t))}function getTemplateString(e){for(var r in delete(e=e||{}).models,delete e.manufacturers,e)null!==e[r]&&void 0!==e[r]||delete e[r];return e.manufacturers=[manufacturerId],e.manufacturersType="PKW",template=encodeURI(JSON.stringify(e)),template}getTemplateString(currentArgs),quicksearch={},quicksearch.initModelSelector=initModelSelector,quicksearch.resetAll=function(e,r){console.log("reset"),$("#fahrzeugart").prop("selectedIndex",0),$("#hersteller").prop("selectedIndex",0),$("#modell").prop("selectedIndex",0),$("#zulassungvon").prop("selectedIndex",0),$("#kilometerbis").prop("selectedIndex",0),$("#kraftstoff").prop("selectedIndex",0),$("#preismin").prop("selectedIndex",0),$("#preismax").prop("selectedIndex",0),queryCount()},quicksearch.run=quicksearch.update=function(){queryCount()},quicksearch.init=function(e){culture=(settings=e).culture||"de-DE",apikey=settings.api.key,baseUri=settings.api.url,target=settings.target||"/",settings.preselection=e.selection||{},settings.url=settings.url.replace("#!/",""),settings.hash=settings.hash||"#!",settings.renameManufacturers=e.renameManufacturers||!0,settings.modelsWithoutFinds=e.modelsWithoutFinds||"hide",settings.modelsWithCounter=e.modelsWithCounter||!1,settings.exactAllLabels=e.exactAllLabels||!1,sortManAlphabetic=e.sortManAlphabetic||!1,settings.hash&&"#!"!==settings.hash&&(settings.hash=""),console.log(settings),settings.label&&$(".quicksearch  h2").text(settings.label),loadConfig(),queryCount(),$(".quicksearch #preismin").change(function(){refreshPriceMin(this),queryCount()}),$(".quicksearch #preismax").change(function(){refreshPriceMax(this),queryCount()}),$(".quicksearch select").change(function(){queryCount()}),$(".quicksearch #hersteller").change(function(){$("#modell").prop("selectedIndex",0),initModelSelector(),queryCount()}),$("#car-search-detail").attr("href",settings.url+settings.hash+"/"),$("#car-search-reset").attr("href","javascript:quicksearch.resetAll();"),queryCount(),initButtons()};